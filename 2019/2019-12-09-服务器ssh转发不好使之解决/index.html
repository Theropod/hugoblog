<!DOCTYPE html>
<html lang="en">
  <head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noodp"/>
  <meta name="author" content="Theropod">
  <meta name="description" content="Theropod的博客 GIS/Music/Gaming/Hardware">
  
  
  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-136276173-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  <link rel="prev" href="https://blog.theropod.tk/2019/2019-05-10-%E8%B6%85%E5%BE%AEipmi%E9%A3%8E%E6%89%87%E8%B0%83%E8%8A%82/" />
  
  <link rel="canonical" href="https://blog.theropod.tk/2019/2019-12-09-%E6%9C%8D%E5%8A%A1%E5%99%A8ssh%E8%BD%AC%E5%8F%91%E4%B8%8D%E5%A5%BD%E4%BD%BF%E4%B9%8B%E8%A7%A3%E5%86%B3/" />
  <link rel="apple-touch-icon" sizes="180x180" href="https://blog.theropod.tk/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://blog.theropod.tk/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://blog.theropod.tk/favicon-16x16.png">
  <link rel="manifest" href="https://blog.theropod.tk/site.webmanifest">
  <link rel="mask-icon" href="https://blog.theropod.tk/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
  <title>
       
       
           2019 12 09 服务器/VSCode ssh转发各种不好使解决 | WGS84教信者
       
  </title>
  <meta name="title" content="2019 12 09 服务器/VSCode ssh转发各种不好使解决 | WGS84教信者">
    
  
  <link rel="stylesheet" href="/font/iconfont.css">
  <link rel="stylesheet" href="/css/main.min.css">


  
  
 

<script type="application/ld+json">
 "@context" : "http://schema.org",
    "@type" : "BlogPosting",
    "mainEntityOfPage": {
         "@type": "WebPage",
         "@id": "https:\/\/blog.theropod.tk"
    },
    "articleSection" : "posts",
    "name" : "2019 12 09 服务器\/VSCode ssh转发各种不好使解决",
    "headline" : "2019 12 09 服务器\/VSCode ssh转发各种不好使解决",
    "description" : "转发失败的问题 本来我可以用ssh -N -D来通过服务器转发本地流量，最近失败，-vvv查看也看不出啥，只有channel 2 open failure. 同时，使用VSCo",
    "inLanguage" : "en",
    "author" : "Theropod",
    "creator" : "Theropod",
    "publisher": "Theropod",
    "accountablePerson" : "Theropod",
    "copyrightHolder" : "Theropod",
    "copyrightYear" : "2019",
    "datePublished": "2019-12-10 14:33:18 \x2b0800 CST",
    "dateModified" : "2019-12-10 14:33:18 \x2b0800 CST",
    "url" : "https:\/\/blog.theropod.tk\/2019\/2019-12-09-%E6%9C%8D%E5%8A%A1%E5%99%A8ssh%E8%BD%AC%E5%8F%91%E4%B8%8D%E5%A5%BD%E4%BD%BF%E4%B9%8B%E8%A7%A3%E5%86%B3\/",
    "wordCount" : "824",
    "keywords" : [ "网管", "WGS84教信者"]
}
</script>

</head>

  


  <body class="">
    <div class="wrapper">
        <nav class="navbar">
    <div class="container">
        <div class="navbar-header header-logo">
        	<a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://blog.theropod.tk">WGS84教信者</a>
        </div>
        <div class="menu navbar-right">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
<nav class="navbar-mobile" id="nav-mobile" style="display: none">
     <div class="container">
        <div class="navbar-header">
            <div>  <a href="javascript:void(0);" class="theme-switch"><i class="iconfont icon-xihuan"></i></a>&nbsp;<a href="https://blog.theropod.tk">WGS84教信者</a></div>
            <div class="menu-toggle">
                <span></span><span></span><span></span>
            </div>
        </div>
     
          <div class="menu" id="mobile-menu">
                
                
                <a class="menu-item" href="/posts/" title="">Blog</a>
                
                <a class="menu-item" href="/categories/" title="">Categories</a>
                
                <a class="menu-item" href="/tags/" title="">Tags</a>
                
                <a class="menu-item" href="/about/" title="">About</a>
                
        </div>
    </div>
</nav>
    	 <main class="main">
          <div class="container">

          
          <div class="post-toc-wrapper">
            <aside class="post-toc">
                <header>
                        <h2>2019 12 09 服务器/VSCode ssh转发各种不好使解决</h2>
                </header>
                <nav id="TableOfContents">
  <ul>
    <li><a href="#heading">转发失败的问题</a></li>
    <li><a href="#windows-vscodepowershellsshconfig">Windows 默认连接（如VSCode或PowerShell）.ssh\config权限损坏</a></li>
    <li><a href="#too-open">用密钥连接服务器，说密钥too open所以不让连接</a></li>
    <li><a href="#windows">原因不明，只能说尽量别用Windows干这个</a></li>
  </ul>
</nav>
            </aside>
          </div>
          

      		
<article class="post-warp" itemscope itemtype="http://schema.org/Article">
    <header class="post-header">
        <h1 class="post-title" itemprop="name headline">2019 12 09 服务器/VSCode ssh转发各种不好使解决</h1>
        <div class="post-meta">
                Written by <a itemprop="name" href="https://blog.theropod.tk" rel="author">Theropod</a> 
                
                <span class="post-time">
                on <time datetime=2019-12-10 itemprop="datePublished">December 10, 2019</time>
                </span>
                in
                <i class="iconfont icon-folder"></i>
                <span class="post-category">
                        <a href="https://blog.theropod.tk/categories/%E6%8A%80%E6%9C%AF/"> 技术 </a>
                        
                </span>
                <span class="post-wordcount">
                    <a>|</a>
                    <a> 824 Words, Estimated Reading time (口胡) : 2 min </a>
                </span>

        </div>
    </header>

    
    <div class="post-toc-wrapper-mobile">
      <aside class="post-toc">
          <header>
                  <h2>TOC</h2>
          </header>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#heading">转发失败的问题</a></li>
    <li><a href="#windows-vscodepowershellsshconfig">Windows 默认连接（如VSCode或PowerShell）.ssh\config权限损坏</a></li>
    <li><a href="#too-open">用密钥连接服务器，说密钥too open所以不让连接</a></li>
    <li><a href="#windows">原因不明，只能说尽量别用Windows干这个</a></li>
  </ul>
</nav>
      </aside>
    </div>
    

    <div class="post-content">
        

        

        
        
     
          
          
          

          
          
          

          <h2 id="heading">转发失败的问题</h2>
<p>本来我可以用ssh -N -D来通过服务器转发本地流量，最近失败，-vvv查看也看不出啥，只有channel 2 open failure.
同时，使用VSCode的remote功能也是失败的。</p>
<p>最后发现关闭服务器SELINUX就可以了。。。。</p>
<h2 id="windows-vscodepowershellsshconfig">Windows 默认连接（如VSCode或PowerShell）.ssh\config权限损坏</h2>
<p>默认连接貌似需要访问<code>C:\Users\Theropod3\.ssh\config</code>权限问题bad owner or permission
教程里都是说要把这个文件安全选项卡权限改成只有用户自己完全控制，其他的全删，但是弄了也没用。PowerShell要是说这个问题就直接把文件删了自动创建，VSCode里还是手动换配置文件路径了</p>
<h2 id="too-open">用密钥连接服务器，说密钥too open所以不让连接</h2>
<p>仍然和之前说的一样，理论上改了权限就可以，但直接换成用户也试过了，不可以。</p>
<p>找到了一个使用默认cacls.exe的方法，复杂操作之后竟然解决了。
<a href="https://blog.yuwu.me/?p=3873">https://blog.yuwu.me/?p=3873</a></p>
<pre><code>&lt;#
//------------------------------------------------------------------------------
// Function: cacls_to_owner_only
// Change the file access permissions to owner only
//------------------------------------------------------------------------------
#&gt;
function cacls_to_owner_only($file)
{
    if ([System.IO.File]::Exists($file)) {
        $cmds = @(
            &quot;icacls.exe &quot;&quot;$file&quot;&quot; /c /t /inheritance:d&quot;,
            &quot;icacls.exe &quot;&quot;$file&quot;&quot; /c /t /grant ${Env:USERNAME}:F&quot;,
            &quot;icacls.exe &quot;&quot;$file&quot;&quot; /c /t /remove Administrator BUILTIN\Administrators BUILTIN Everyone System Users &quot;&quot;Authenticated Users&quot;&quot;&quot;
        )
        foreach ($cmd in $cmds) {
            Write-Host $cmd
            iex $cmd
            Write-Host &quot;&quot;
        }
    }
    else {
        Write-Error &quot;File not found: ``$file``&quot;
    }
}
</code></pre><p>虽然函数说的是{Env:USERNAME},但是实际权限里看到加入的是字母+数字超长字符的对象
|PEM文件和操作|WSL ssh|WSL sudo ssh|Powershell(管理员无关)|VSCode(管理员无关)|
| &ndash; | &ndash; | &ndash; | &ndash; | &ndash; |
|修改前Windows中权限：Authenticated Users, SYSTEM, Administrators(THEROPOD3\Administrators), users(Theropod3\Users)| too open, 不可以连接 | 可以 | too open | too open|
|使用cacls_to_owner_only后| permission denied | permission denied | permission denied | permission denied|
|安全选项卡再次加上用户完全控制| too open|too open|too open|too open|
|再删掉新加入的对象|too open|可以|可以|可以|</p>
<ul>
<li>总结下来，就是用cacls_to_owner_only，然后把新加上的对象删了，再加上用户。最终结果还是像教程说的，只剩自己的用户名。但是经过中间的操作，就不知道为什么成功，直接操作不成功。</li>
</ul>
<h2 id="windows">原因不明，只能说尽量别用Windows干这个</h2>

    </div>

    <div class="post-copyright">
            

             
            <p class="copyright-item lincese">
                本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/" target="_blank">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可
            </p>
            
    </div>

  
    <div class="post-tags">
        
            <section>
            <i class="iconfont icon-tag"></i>Tag(s): 
            
            <span class="tag"><a href="https://blog.theropod.tk/tags/%E7%BD%91%E7%AE%A1/">
                    #网管</a></span>
            
            </section>
        
        <section>
                <a href="javascript:window.history.back();">back</a></span> · 
                <span><a href="https://blog.theropod.tk">home</a></span>
        </section>
    </div>

    <div class="post-nav">
        
        <a href="https://blog.theropod.tk/2019/2019-05-10-%E8%B6%85%E5%BE%AEipmi%E9%A3%8E%E6%89%87%E8%B0%83%E8%8A%82/" class="prev" rel="prev" title="半途而废-超微IPMI风扇调节"><i class="iconfont icon-left"></i>&nbsp;半途而废-超微IPMI风扇调节</a>
         
        
    </div>

    <div class="post-comment">
          
                 
                     <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "theropodblog" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                 
          
    </div>
</article>
          </div>
		   </main>
      <footer class="footer">
    <div class="copyright">
        &copy;
        
        <span itemprop="copyrightYear">2015 - 2019</span>
        
        <span class="with-love">
    	 <i class="iconfont icon-love"></i> 
         </span>
         
            <span class="author" itemprop="copyrightHolder"><a href="https://blog.theropod.tk">Theropod</a> | </span> 
         

         
		  <span>Powered by <a href="https://gohugo.io/" target="_blank" rel="external nofollow">Hugo</a> & <a href="https://github.com/liuzc/leaveit" target="_blank" rel="external nofollow">LeaveIt</a></span> 
    </div>
</footer>












    
    
    <script src="/js/vendor_no_gallery.min.js" async=""></script>
    
  



     </div>
  </body>
</html>
