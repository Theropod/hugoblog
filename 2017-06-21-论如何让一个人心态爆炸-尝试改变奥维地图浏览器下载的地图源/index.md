# 论如何让一个人心态爆炸-尝试改变奥维地图浏览器下载的地图源


<!--more-->

小学期实习需要做一个土地利用调查，在根据影像绘制好地块的面之后，将其转成kmz导入到一个奥维互动地图的app（因为据说野外用这个手机上编辑属性方便一些？），发现图斑有偏移。。。
有可能是给我们的影像没做好几何校正，矢量化的时候描歪了，也有可能是火星坐标系的问题，因为看了一下奥维下载的地图清一色都是国内的源。
奥维的地图数据居然是按zoom级别的.sdb格式，（不知道是啥，是超图的数据库吗？）只能从电脑上离线一个再复制到手机里。我就尝试在PC端设置成khm3.google.com的国外版的卫星瓦片数据源，下载之后加载看有没有问题。但是自定义地图服务器这个功能居然要vip收费。。。。幸亏这个PC端可以使用代理端口，于是就先设置一个fiddler的监听（act as http proxy），PC客户端里使用这个端口下载。在FiddlerScript里面写一个规则：

```

        //适用于奥维互动地图浏览器的rule,强制它下载国外版的谷歌瓦片
        if (oSession.HostnameIs("mt0.google.cn")) {
            oSession.hostname="khms3.google.com";
        }
         if (oSession.uriContains("/vt/lyrs=s")) {
            oSession.url=oSession.url.Replace("/vt/lyrs=s@727&hl=zh-CN&gl=cn&src=app&","/kh/v=726?");
         }
        //
```
于是就强制下载无偏瓦片了。
结果这个叠上去一看偏得更多了。。。把这些图斑用Openlayers加载到谷歌无偏瓦片上面，又加载到谷歌地球里面，都发现效果和不改变下载源的效果一样。原来是奥维这个东西本身就把所有的在线地图图层纠偏过了，只和谷歌地球有及其微小的误差。。。怪不得评价都说这个app好来着。
那就只可能是因为底图错了导致矢量化错了，查了一下果然如此
至此终于知道了为什么偏移，但是一个晚上过去了。。。也不知道谁最开始说的可能是火星坐标系的问题，我居然就信了，要是早早验证底图就没有这么多事情。
心态崩了
